{% extends "base.html" %}

{% block title %}æ–°å¢é¡Œåº« - ç·šä¸Šé¡Œåº«ç³»çµ±{% endblock %}

{% block content %}
<div class="form-container" style="max-width: 600px;">
    <h2 style="text-align: center; margin-bottom: 2rem; color: #333;">ğŸ“ å»ºç«‹æ–°é¡Œåº«</h2>
    
    <div id="alert-container"></div>
    
    <form id="create-quiz-form">
        <div class="form-group">
            <label for="title">é¡Œåº«æ¨™é¡Œ *</label>
            <input type="text" id="title" name="title" required placeholder="ä¾‹å¦‚ï¼šç¨‹å¼è¨­è¨ˆåŸºç¤æ¸¬é©—">
        </div>
        
        <div class="form-group">
            <label for="description">é¡Œåº«æè¿°</label>
            <textarea id="description" name="description" rows="4" placeholder="æè¿°é€™å€‹é¡Œåº«çš„å…§å®¹å’Œç›®çš„..."></textarea>
        </div>
        
        <div class="form-group">
            <label for="folder">é¸æ“‡è³‡æ–™å¤¾ (é¸å¡«)</label>
            <select id="folder" name="folder">
                <option value="">ä¸æ”¾å…¥è³‡æ–™å¤¾</option>
                {% for folder in folders %}
                <option value="{{ folder.id }}">{{ folder.name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div style="display: flex; gap: 1rem;">
            <button type="submit" class="btn" style="flex: 1;">
                <span id="create-text">å»ºç«‹é¡Œåº«</span>
                <span id="create-loading" class="loading" style="display: none;"></span>
            </button>
            <a href="{{ url_for('teacher_dashboard') }}" class="btn btn-secondary" style="flex: 1; text-align: center; line-height: 1.5;">å–æ¶ˆ</a>
        </div>
    </form>
    
    <div style="margin-top: 2rem; padding: 1.5rem; background: #f8f9fa; border-radius: 8px;">
        <h4 style="color: #333; margin-bottom: 1rem;">ğŸ’¡ å»ºç«‹é¡Œåº«å¾Œæ‚¨å¯ä»¥ï¼š</h4>
        <ul style="color: #666; line-height: 1.6;">
            <li>æ–°å¢å„ç¨®é¡å‹çš„é¡Œç›®ï¼ˆå–®é¸ã€å¤šé¸ã€å¡«ç©ºã€ç¨‹å¼ç¢¼æ’åºç­‰ï¼‰</li>
            <li>è¨­å®šæ¯é¡Œçš„åˆ†æ•¸å’Œæ­£ç¢ºç­”æ¡ˆ</li>
            <li>ç²å¾—å°ˆå±¬çš„é¡Œåº«ä»£ç¢¼ï¼Œåˆ†äº«çµ¦å­¸ç”Ÿ</li>
            <li>æŸ¥çœ‹å­¸ç”Ÿçš„ä½œç­”çµæœå’Œæˆç¸¾çµ±è¨ˆ</li>
        </ul>
    </div>
</div>

<script>
document.getElementById('create-quiz-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const title = document.getElementById('title').value.trim();
    const description = document.getElementById('description').value.trim();
    
    // æ¸…é™¤ä¹‹å‰çš„éŒ¯èª¤è¨Šæ¯
    clearAlert();
    
    if (!title) {
        showAlert('è«‹è¼¸å…¥é¡Œåº«æ¨™é¡Œ', 'error');
        return;
    }
    
    // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
    setLoading(true);
    
    try {
        const response = await fetch('/create-quiz-bank', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                title: title,
                description: description,
                folder_id: document.getElementById('folder').value || null
            })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showAlert(`é¡Œåº«å»ºç«‹æˆåŠŸï¼é¡Œåº«ä»£ç¢¼ï¼š${data.access_code}`, 'success');
            setTimeout(() => {
                window.location.href = `/quiz-bank/${data.quiz_bank_id}`;
            }, 2000);
        } else {
            showAlert(data.error || 'å»ºç«‹é¡Œåº«å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
        }
    } catch (error) {
        showAlert('ç¶²è·¯éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥é€£ç·š', 'error');
    } finally {
        setLoading(false);
    }
});

function showAlert(message, type) {
    const alertContainer = document.getElementById('alert-container');
    alertContainer.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
}

function clearAlert() {
    document.getElementById('alert-container').innerHTML = '';
}

function setLoading(loading) {
    const text = document.getElementById('create-text');
    const spinner = document.getElementById('create-loading');
    const button = document.querySelector('#create-quiz-form button[type="submit"]');
    
    if (loading) {
        text.style.display = 'none';
        spinner.style.display = 'inline-block';
        button.disabled = true;
    } else {
        text.style.display = 'inline';
        spinner.style.display = 'none';
        button.disabled = false;
    }
}
</script>
{% endblock %}
