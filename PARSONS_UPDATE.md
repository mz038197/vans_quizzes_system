# 程式碼排序題型更新說明

## 更新內容

針對程式碼排序題型（Parsons Problem）進行了重大改進，提供更靈活的題目設置方式。

## 新功能

### 1. 自由設定程式碼區塊
- 老師可以添加任意數量的程式碼區塊
- 每個程式碼區塊會自動標記為 A、B、C、D...
- 可以包含正確答案和干擾項，不需要分開設置

### 2. 自訂答案區空格數量
- 老師可以自由決定答案區有多少個空格
- 空格數量可以少於程式碼區塊總數（例如：5個程式碼區塊，只需要填3個空格）
- 增加題目的靈活性和難度調整

### 3. 獨立設定每個空格的正確答案
- 為每個空格獨立選擇正確的程式碼區塊
- 支持不按順序的答案設置
- 更符合實際的程式設計教學需求

## 使用方法

### 建立新的程式碼排序題

1. **添加程式碼區塊**
   - 點擊「新增程式碼塊」按鈕
   - 輸入程式碼內容（支援多行）
   - 每個程式碼區塊會自動分配標籤（A、B、C...）

2. **設定答案區空格**
   - 在「答案區空格數量」輸入框中輸入需要的空格數量
   - 點擊「更新空格」按鈕

3. **設定正確答案**
   - 為每個空格從下拉選單中選擇正確的程式碼區塊標籤
   - 系統會顯示每個標籤對應的程式碼預覽

4. **儲存題目**
   - 確認所有設定正確後點擊「儲存題目」

### 範例

假設要建立一個排序題目：

**程式碼區塊：**
- A: `def hello():`
- B: `    print("Hello")`
- C: `    return True`
- D: `hello()`
- E: `goodbye()`

**答案區設定：** 3個空格
- 空格 1: A
- 空格 2: B
- 空格 3: D

這樣學生需要從5個選項中選擇3個正確的程式碼區塊，並按順序放入答案區。

## 學生答題

學生在答題時：
1. 可以看到所有可選的程式碼區塊（標記為A、B、C...）
2. 將程式碼區塊拖拉到答案區對應的空格中
3. 系統會自動記錄每個空格選擇的程式碼區塊標籤

## 評分邏輯

系統會比對每個空格的答案：
- 如果所有空格的程式碼區塊標籤都正確，則給分
- 只要有一個空格錯誤，整題不給分

## 舊題目兼容性

系統完全兼容舊格式的程式碼排序題：
- 編輯舊題目時會自動轉換為新格式
- 學生可以正常答題
- 評分邏輯自動處理新舊格式

## 技術細節

### 資料結構

新格式的題目資料：
```json
{
  "code_blocks": {
    "A": "def hello():",
    "B": "    print(\"Hello\")",
    "C": "    return True",
    "D": "hello()",
    "E": "goodbye()"
  },
  "answer_slots": 3,
  "slot_answers": {
    "1": "A",
    "2": "B",
    "3": "D"
  }
}
```

學生答案格式：
```json
{
  "slot_answers": {
    "1": "A",
    "2": "B",
    "3": "D"
  }
}
```

## 修改的檔案

1. `templates/manage_quiz_bank.html` - 題目編輯界面
2. `templates/take_quiz.html` - 學生答題界面
3. `templates/result.html` - 結果顯示頁面
4. `app.py` - 評分邏輯

## 測試建議

1. 建立一個新的程式碼排序題，測試基本功能
2. 測試不同數量的程式碼區塊和空格組合
3. 讓學生答題並檢查評分是否正確
4. 編輯舊題目，確認向下兼容性
5. 查看結果頁面，確認答案顯示正確

## 注意事項

- 至少需要2個程式碼區塊
- 必須為所有空格設定正確答案
- 答案區空格數量應小於或等於程式碼區塊總數
- 程式碼區塊內容支援多行代碼

---

更新日期：2025-10-20

